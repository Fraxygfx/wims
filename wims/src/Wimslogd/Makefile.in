# @configure_input@

wims_home=../..
cc=@CC@
cflags=@CFLAGS@ -Wall
LDFLAGS=@LDFLAGS@
CPPFLAGS=@CPPFLAGS@

defines=@DEFINES@
STRIP=@STRIP@
lopt=-L../../lib -lwims -lm

wimslogdobjects=cache.o cleaning.o cmd.o files.o fork.o homedir.o housekeep.o log.o options.o socket.o wimslogdlines.o score.o wimslogd.o

all: wimslogd

%.o: %.c wimslogd.h ../wimsdef.h ../Lib/libwims.h
	$(cc) -o $@ $(cflags) $(defines) -c $<

clean:
	rm -f *.o wimslogd

distclean:
	make clean
	rm -f $(wims_home)/bin/wimslogd
	rm -f Makefile

wimslogd: $(wimslogdobjects)
	$(cc) $(LDFLAGS) $(defines) $(wimslogdobjects) $(lopt) -o wimslogd
	$(STRIP) wimslogd
	rm -f $(wims_home)/tmp/log/wimslogd.pid $(wims_home)/sessions/.wimslogd
	cp wimslogd $(wims_home)/tmp/log/wimslogd.new
