##create teacherlist and .teacherlist_external at all levels
## le paramètre est la classe

uclass=$wims_read_parm
superclass=!defof class_superclass in wimshome/log/classes/$uclass/.def
!default superclass=$wims_superclass
!default uclass=$wims_superclass
!!! je ne comprends pas : l'indexation ne se fait pas sinon lorsqu'un enseignant s'inscrit
!default superclass=$uclass
!default wims_superclass=$class
!!!
!if $superclass=$empty
 !exit
!endif
!if $wims_superclass!=$empty and $superclass!=$wims_superclass and $wims_ismanager<2
 !exit
!endif

basedir=wimshome/log/classes/$superclass
basedir2=$wims_home/log/classes/$superclass
basedirr=wimshome/log/classes/$uclass
basedirr2=$wims_home/log/classes/$uclass
tlist=!sh cd $basedir2/.users\
	grep -l user_supervisable=yes *
tlist=!words2items $tlist

!writefile $basedirr/.teacherlist.1
!writefile $basedirr/.teacherlist_external.1
!for t in $tlist
  US_=!defof user_supervise in $basedir/.users/$t
  !if $superclass=$uclass or $uclass isitemof $US_
   U_=!defof user_lastname,user_firstname in $basedir/.users/$t
   !appendfile $basedirr/.teacherlist.1 $U_,$t
 !endif
  EXT_=!defof user_external_auth in $basedir/.users/$t
  !if $EXT_!=$empty
   !appendfile $basedirr/.teacherlist_external.1 $EXT_,$t
  !endif
!next t

!sh sort -f $basedirr2/.teacherlist.1 | grep . >$basedirr2/.teacherlist\
  rm -f $basedirr2/.teacherlist.1 >/dev/null

!sh sort -f $basedirr2/.teacherlist_external.1 | grep . >$basedirr2/.teacherlist_external\
  rm -f $basedirr2/.teacherlist_external.1 >/dev/null

