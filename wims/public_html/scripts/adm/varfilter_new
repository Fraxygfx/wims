!bound wims_read_parm within proc,html,htmldiv default $empty

!if $wims_read_parm!=$empty
	!goto $wims_read_parm
!endif
!exit

:proc
 !if $varfilterclear!=$empty
    !reset varfilter,varfilter_
    !writefile wimshome/s2/$wims_session/varfilter $varfilter
 !else
  !if $varfilter=$empty and $wims_user=supervisor
	varfilter=!record 0 of wimshome/s2/$wims_session/varfilter
  !else
	!writefile wimshome/s2/$wims_session/varfilter $varfilter
  !endif
 !endif
 !if $varfilter!=$empty
   !reset varfilter_
   !set varfilter_cnt=!linecnt $varfilter
   !for v=1 to $varfilter_cnt
    var_line=!singlespace $(varfilter[$v;])
    var_line =!replace $ $ by , in $var_line
    varfilter_=!append line $var_line to $varfilter_
   !next v
 !endif
!exit

:html
!reset lang_isread
!readproc adm/lang/varfilter.$lang
!if $lang_isread!=yes
 !readproc adm/lang/varfilter.en
!endif
<fieldset class="property_fields halfwidth blockcenter">
 <legend>$name_filtertitle (NEW VARFILTER WORK IN PROGRESS)</legend>
  $name_filter
  <br/>
  <textarea name="varfilter" cols="20" rows="3">$varfilter</textarea>
  <input type="submit" value="$name_clear" name="varfilterclear" />
  !set wims_ref_class=wims_button_help float_right
  !href target=wims_mhelp cmd=help&special_parm=filter $wims_name_help
  <div class="wimsform wimscenter">
  <input type="submit" value="$wims_name_Show" />
  </div>
</fieldset>
!exit

:htmldiv
 !reset lang_isread
 !readproc adm/lang/varfilter.$lang
 !if $lang_isread!=yes
  !readproc adm/lang/varfilter.en
 !endif
 <div class="field box">
 <label for="showsheet">$name_filtertitle (NEW VARFILTER WORK IN PROGRESS)</label>
  <br/>
  $name_filter
  <br/>
  <textarea name="varfilter" cols="20" rows="3">$varfilter</textarea>
  <input type="submit" value="$name_clear" name="varfilterclear" />
  !set wims_ref_class=wims_button_help float_right
  !href target=wims_mhelp cmd=help&special_parm=filter $wims_name_help
 </div>
!exit
