
!set appletdir=$imagedir
!set appletdir=java/jmol

!distribute lines $(reply$i) into score,selgood,selbad,selforget,ans_sc1,ans_orient
!for j in selgood,selbad,selforget
  !set $j=!translate {()} to $ $ $ $ $ in $($j)
  !set $j=!singlespace $($j)
  !set $j=!words2items $($j)
  !set $j=!values x+1 for x in $($j)
!next
!set for_feedback=$selgood;$selbad;$selforget

nbsel=!getopt nbsel in $(replyoption$i)

!distribute lines $oef_applet_option into size,file,ans_sc0,ans_sc2

!if $wims_read_parm=nocompare
  reply$i=$(m_reply$i)
  !set for_feedback=$selbad
  !goto applet
!endif

!if $score=1 
 diareply$i=good
 !advance freegot
!else
   diareply$i=bad
   freegot=$[$freegot+$score]
!endif
 
:applet

reply_$i=<script type="text/javascript" src="$appletdir/Jmol.js"></script>
reply_$i=$(reply_$i)

reply_$i=$(reply_$i)<script type="text/javascript">\
    jmolInitialize('$appletdir','JmolApplet.jar');\
    jmolSetAppletColor("white");\
    jmolSetCallback("menuFile", "$appletdir/Jmol.mnu");\
    var sc0='$ans_sc0';\
    var sc2='$ans_sc2';\
    var sc1='$ans_sc1';\
    var orient='$ans_orient';\
    var jscr='load $file;';\
    jscr= jscr +'selectionhalos on;select none;set frank off;';\
    retcode=jmolApplet([$size],jscr+sc1+sc2+sc0+orient);\
</script>

!set reply_$i=$(reply_$i)
!set m_reply$i=$for_feedback
!set reply$i=
