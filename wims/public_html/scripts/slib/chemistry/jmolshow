!if $wims_read_parm!=slib_header
 !goto proc
!endif
slib_title=Jmol Applet
slib_parms=5\
,MDMol file or address (internal in wims)\
500,xsize\
400,ysize\
white,color\
,jmol script
slib_author=Yves Noël et Bernadette Perrin-Riou
slib_out=applet code for inserting jmol applet
slib_comment=
!!exemple à changer ensuite mais sert de test.
slib_example=data/molecule_pdb/reseau1.pdb\
data/molecule_pdb/xeo2f2.pdb\
datamodule/chemistry/mol2D.fr/data/60_18_4.mol
!exit

:proc
!distribute items $wims_read_parm into slib_file,slib_xsize,slib_ysize,slib_color,slib_script
!set slib_appletdir=java/jmol

!default slib_xsize=500
!default slib_ysize=400
!default slib_color=white
!set slib_file=!replace internal $	$ by $\
$ in $slib_file
!set slib_file=\
$slib_file

!set slib_file=!replace internal ; by $\
\$ in $slib_file
!set slib_test=!linecnt $slib_file
!if $slib_test=1
  !if __http isin __$slib_file
   !goto begin
  !else
   !set slib_temp=!record 0 of $slib_file
  !endif
!else
  slib_temp=$slib_file
!endif
!set slib_file0=!randint 1000,5000
!readproc oef/togetfile.proc $slib_file0 new\
$slib_temp
!set slib_file=$wims_ref_name?session=$session&+cmd=getfile&+special_parm=$slib_file0
!endif

:begin

!default slib_DisablePopupMenu=TRUE
!default slib_hover=on

!if .spt__  isin $(slib_script)__ and __data isin __$slib_script
    !set temp=!record 0 of $(slib_script)
    !set slib_script_file0=!replace internal / by , in $(slib_script)
    !readproc oef/togetfile.proc $(slib_script_file0[-1]) new\
$temp
    !set slib_script_file=$wims_ref_name?session=$session&+cmd=getfile&+special_parm=$(slib_script_file0[-1])
    !reset slib_script
!endif
!if $slib_script!= 
  slib_script=+'$slib_script'
!endif
!if $slib_script_file!= 
  slib_script_file=jmolScriptWait('script $slib_script_file;');
!endif

!set slib_out=<script type="text/javascript" src="$slib_appletdir/Jmol.js"></script> \
<script language="javascript" type="text/javascript">\
      jmolInitialize('$slib_appletdir','JmolApplet.jar');\
      jmolSetAppletColor('$slib_color');\
   var jscr='load $slib_file;';\
    jscr= jscr +'selectionhalos on;select none;set picking off; set frank on;set DisablePopupMenu $slib_DisablePopupMenu; hover $slib_hover;';\
    jscr=jscr $slib_script;\
    jmolApplet([$slib_xsize,$slib_ysize],jscr);\
    $slib_script_file\
</script>
