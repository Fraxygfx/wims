!! 7 types of input are possible with this page , single or in any combination
!! 1) mathview inputapplet via id="MathView" ; 
!! 2) inputfields via id="myinput0" ... id="myselect100"
!! 3) selectboxes via id="myselect0" ... id="myselect100"
!! 4) mathml inputfields via id="mathml0" ... id="mathml100"
!! 5) svg answer (via draw or inputfields/textarea [ read_svg();]
!! 6) FlyApplet drawing via ReadDrawing() : coordinates/points/lines x1:y1,x2:y2,x3:y3....x_n:y_n (wordmax (=20) is adjustable upperlimit ; wordmin (=1) is adjustable underlimit) from FlyApplet0...FlyApplet100
!! 7) InvulGrid applet via ReadApplet(0,1,2,3) ; carefull applet produces large strings (html/latex)
!if $my_arrows=$empty
    !set my_arrows=2
!endif

<script type="text/javascript">
//<![CDATA[
    var URL;

    function dontknow(){
	t = confirm(r0+"\n$dontknow ?");
	if( t == true){
	    URL = '$wims_ref_name?session=$session&+module=$module&+cmd=reply&+reply$n=%3F' ;
	    document.location.href = URL;if(document.getElementById("MathView")){document.getElementById("MathView").destroy();}
	}
    }

    function sendanswer(){
	var input;
	var show="";
	var reply = new Array();
	var applet = 0;
	var inputfieldnumber = 0;
	var input;
	if(document.getElementById("MathView")){
	    input=document.getElementById("MathView").getLinear();input = input+'';
	    if( input.length == 0){setAlarm(r1+"\ 1");return;}
	    if( input.length > 100){setAlarm(r2); return;}
	    if(input.indexOf('error')!=-1){setAlarm(input);return;}
	    input = arrows(input,$my_arrows,"","");if(input == "error"){return;}
	    input = nthroot(input);if(input ==" error"){return;}
	    if(input.indexOf(',') != -1){setAlarm(r4);return;}
	    if(check_f(input) == 0){return;}if(check_o(input) == 0){return;}
	    if(check_log_NaN(input) == 0){return;}if(check_sqrt_NaN(input) == 0){return;}
	    input = science(input);if(input == "error"){return;}
	    if(check_x(input) == 0){return;}
	    show=input+"\n";
	    if(input.indexOf("[") !=- 1){
		if(input.indexOf("sqrt[")!=-1){input=specialroot(input);if(input=="error"){return;}}
		if(input.indexOf("log[")!=-1){input=speciallog(input);if(input=="error"){return;}}
		if( input.indexOf("[") !=-1){setAlarm(r13);return;}
	    }
	    input = input.replace(/#/g,' ');
	    reply[0] = input;
	    applet=1;
	    inputfieldnumber = 1;
	}

	if(document.getElementById("InvulGrid0") ){
	    var p = 0;var tmp_show;var tmp_reply;var tmp_htmlreply;var tmp_latexreply;
	    var latexreply = "";var invulgrid;
	    !if $decimals=1
		var decimals=1;
	    !else
		var decimals=0;
	    !endif
	    while( document.getElementById('InvulGrid'+p )){
		invulgrid = document.getElementById('InvulGrid'+p);
		tmp_show = invulgrid.ReadApplet('1');
		tmp_reply = invulgrid.ReadApplet('0');
		tmp_htmlreply = invulgrid.ReadApplet('2');
		tmp_latexreply = invulgrid.ReadApplet('3');
		if(tmp_reply.indexOf('error')!= -1){setAlarm(r26+"<br />(java applet no."+parseInt(p+1)+")");return;}
		if(tmp_reply.indexOf("?") != -1){dontknow();return;}
		if(decimals == 0){ 
		    tmp_reply = tmp_reply.replace(/\./g,'');
		    tmp_show = tmp_show.replace(/\./g,'');
		}
		reply[inputfieldnumber] = tmp_reply+"\n"+tmp_htmlreply+"\n"+tmp_latexreply;
		inputfieldnumber++;
		show = show+tmp_show+"\n"
		p++;
		if(p>10){setAlarm(r2);dontknow();}
	    }
	}
	
	if(document.getElementById("FlyApplet0") ){
	<!-- id="FlyApplet0" is not interfering with non-readable FlyApplet based illustrations (id="FlyApplet") -->
	    var p=0;var rep;
	    while( document.getElementById("FlyApplet"+p) ){
		try{
		    rep=document.getElementById('FlyApplet'+p).ReadDrawing();
		}catch(e){
		    setAlarm(r1+" $counter");return;
		}
		if(rep.indexOf("error")!=-1){
		    setAlarm(r1+" $counter");return;
		}
		var tmp=rep.split(',');
		if( tmp.length > $wordmax ){setAlarm(r6);return;}
		if( tmp.length < $wordmin ){setAlarm(r26);return;}
		for(var r = 0;r < tmp.length;r = r+2){
		    show=show+"( "+tmp[r]+" : "+tmp[r+1]+" )\n";
		    reply[inputfieldnumber] = tmp[r]+":"+tmp[r+1];
		    inputfieldnumber++;
		}
		p++;
		if(p>10){setAlarm(r2);dontknow();}
	    }
	}

	if(document.getElementById("myinput0")){
	    var p=0;
	    while(document.getElementById("myinput"+p)){
		input = document.getElementById("myinput"+p).value;
		if(input.length == 0){setAlarm(r1+"\ "+parseInt(p+1));return;}
		input = nthroot(input);if(input == "error"){return;}
		if(input.indexOf(',') != -1){setAlarm(r4);return;}
		input = arrows(input,$my_arrows,"","");if(input == "error"){return;}
		if(check_f(input) == 0){return;}
		if(check_o(input) == 0){return;}
		if(check_log_NaN(input) == 0){return;}
		if(check_sqrt_NaN(input)==0){return;}
		input = science(input);if(input == "error"){return;}
		if(check_x(input) == 0){return;}
		show=show+input+"\n";
		if( input.indexOf("[") !=- 1 ){
		    if(input.indexOf("sqrt[")!=-1){input=specialroot(input);if(input=="error"){return;}}
		    if(input.indexOf("log[")!=-1){input=speciallog(input);if(input=="error"){return;}}
		    if(input.indexOf("[") != -1){setAlarm(r13);return;}
		}
		input=input.replace(/#/g,' ');
		reply[inputfieldnumber] = input;
		inputfieldnumber++;
		p++;
		if(p>100){setAlarm(r2);dontknow();}
	    }
	}
	
	if( document.getElementById("myselect0") ){
	    var p = 0;var options;var option_value;var option_text;
	    while(document.getElementById("myselect"+p)){
		options = document.getElementById("myselect"+p).options;
		option_value = options[options.selectedIndex].value;
		option_text = options[options.selectedIndex].text;
		reply[inputfieldnumber]=option_value;
		show=show+option_text+"\n";
		inputfieldnumber++;
		p++;
		if(p>100){setAlarm(r2);dontknow();}
	    }
	}
	
	if(document.getElementById("mathml0")){
	    var p = 0;
	    while(document.getElementById("mathml"+p)){
		input = document.getElementById('mathml'+p).value;
		if (input.length == 0){setAlarm(r1+" "+parseInt(p+1));return;}
		input = nthroot(input);if(input == "error"){return;}
		if(input.indexOf(',') != -1){setAlarm(r4);return;}
		input = arrows(input,$my_arrows,"","");if(input == "error"){return;}
		if(check_f(input) == 0){return;}if(check_o(input) == 0){return;}
		if(check_log_NaN(input) == 0){return;}if(check_sqrt_NaN(input) == 0){return;}
		input=science(input);if(input == "error"){return;}
		if(check_x(input) == 0){return;}
		show=show+input+"\n";
		if( input.indexOf("[") !=- 1 ){
		    if(input.indexOf("sqrt[") != -1){input = specialroot(input);if(input == "error"){return;}}
		    if(input.indexOf("log[") != -1){input = speciallog(input);if(input == "error"){return;}}
		    if(input.indexOf("[") != -1){setAlarm(r13);return;}
		}
		input = input.replace(/#/g,' ');
		if(p>99){break;}
		reply[inputfieldnumber] = input;
		inputfieldnumber++;
		p++;
		if(p>100){setAlarm(r2);dontknow();}
	    }
	}
	
	try{
	    var svg_reply = read_svg();
	    if(svg_reply.length > 100 ){setAlarm(r2);dontknow();}
	    for( var p = 0 ; p < svg_reply.length ; p++){
		input = svg_reply[p];
		if (input.length == 0){setAlarm(r1+" "+parseInt(p+1));return;}
		input = nthroot(input);if( input == "error"){return;}
		input = arrows(input,$my_arrows,"","");if(input == "error"){return;}
		if(check_f(input) == 0){return;}
		if(check_o(input) == 0){return;}
		if(check_log_NaN(input) == 0){return;}
		if(check_sqrt_NaN(input) == 0){return;}
		input = science(input);if(input == "error"){return;}
		show=show+input+"\n";
		if( input.indexOf("[") !=- 1 ){
		    if(input.indexOf("sqrt[") != -1){input = specialroot(input);if(input == "error"){return;}}
		    if(input.indexOf("log[") != -1){input = speciallog(input);if(input == "error"){return;}}
		    if(input.indexOf("[") != -1){setAlarm(r13);return;}
		}
		input = input.replace(/#/g,' ');
		reply[inputfieldnumber] = input;
		inputfieldnumber++;
	    }	
	}catch(e){}
	
	if(reply[0].length == 0 ){setAlarm(r1);return;}
	
	if(confirm(r0+"\n"+show)){
	    document.getElementById('exercise').setAttribute('style','background-color:#ffafdd');
	    reply=encodeURIComponent(reply);
	    URL = '$wims_ref_name?session=$session&+module=$module&+cmd=reply&+reply$n='+reply ;
	    document.location.href = URL;
	}
    }
//]]>
</script>
<table id="exercise" class="exercise" >
    <tr>
    <td class="exercise_t">
	!if $(question$n) != $empty
	    $(question$n)
	    <br />
	!endif
	!if $embed=1
	    !if $(formula$n) != $empty
	    <table class="exercise">
		<tr>
		<td class="exercise_m">
		    !insmath $(formula$n)
		</td>
		<td class="exercise_m">
		!if $inputs=1
		    !if $wims_user=supervisor
			$m_rightarrow &nbsp;&nbsp;<textarea id="myinput0" class="schaersvoorde_textarea" cols="$cols" rows="$rows">$(answer$n)</textarea>&nbsp;$ex1
        	    !else
        		$m_rightarrow &nbsp;&nbsp;<textarea id="myinput0" class="schaersvoorde_textarea" cols="$cols" rows="$rows">$(reply$n)</textarea>&nbsp;$ex1
		    !endif
		!else
		    <ul class="vlist">
		    !set a_items=!itemcnt $(answer$n)
		    !if $a_items != $[floor($inputs)]
			!set use_lines=1
		    !else
			!set use_lines=0
		    !endif
		    !for p=1 to $inputs
			<li>
			!if $wims_user=supervisor
			    !if $use_lines=1
				!set deelantwoord=!line $p of $(answer$n)
			    !else
				!set deelantwoord=!item $p of $(answer$n)
			    !endif
        		!else
			    !set deelantwoord=!item $p of $(reply$n)
			!endif
			$m_rightarrow&nbsp;&nbsp;<input type="text" id="myinput$[$p-1]" class="schaersvoorde_input" size="$cols" value="$deelantwoord" />&nbsp;$(ex$p)
			</li>
		    !next p
		    </ul>
		!endif
		</td>
	    </table>
	    !endif
	!else
	    !insmath $(formula$n)
	    <br />
	!endif
	!if $exotext != $empty
	    <br />
	    $exotext
	!endif
    </td>
!if $image=1
    !if $XSIZE > 450
    </tr>
    <tr>
    !endif
    <td class="exercise_c">
    !if $draw=1
	!set insdraw_size=$(image_settings$n)
	!insdraw $(image$n)
    !endif
    !if $plot=1
	!set insplot_set=$(image_settings$n)
	!insplot $(image$n)
    !endif
    !if $svg=1
	!exec svgdraw $(image$n)
    !endif
    </td>
!else
    !if $applet=1
	!if $XSIZE > 450 
        </tr>
	<tr>
        !endif
	<td class="exercise_c">
	    $(object$n)
	</td>
    !endif
!endif
!if $mathview=3
    </tr>
    <tr>
    <td class="exercise_c">
	<object classid="java:MathView.class" id="MathView" width="580" height="280" type="application/x-java-applet;jpi-version=1.4" >
	    <param name="java_codebase" value="$appletdir" />
	    <param name="java_archive" value="MathView.jar" />
	    <param name="java_code" value="MathView" />
	    <param name="mayscript" value="true" />
	    <script language="javascript" type="text/javascript" />
	    //<![CDATA[
	    var thisbackground=document.bgColor;if(thisbackground){var obj="\<param name=\"bgcolor\" value=\""+thisbackground+"\" />"}else{var obj="\<param name=\"bgcolor\" value=\"#ffffff\" />"} document.write(obj.toString());
	    //]]>
	    </script>
	    <param name="largefont" value="$largefont">
	!if $wims_user=supervisor
	    <param name="oldreply" value="
	    !nospace $(answer$n)
	    "/>
	!else
	    <param name="oldreply" value="
	    !nospace $(reply$n)
	    "/>
	!endif
	    <param name="smallfont" value="$smallfont" />
	    <param name="helptext" value="$applettext" />
	    <param name="wimsvars" value="$varlist" />
	    <param name="special_fraction" value="$special_fraction" />
	    !! declare varlist=x,y,z,s    or varlist=x y z s
	!if $mathviewpanel=$empty
	    <param name="my_panel" value="$module_title:and:or:sqrt():+:-:*:/">
	!else
	    <param name="my_panel" value="$mathviewpanel" />
	!endif
	    $nojava
	</object>
    </td>
!else
 !if $embed != 1
    !if $XSIZE>450
    </tr>
    <tr>
    !endif
    <td class="exercise_t">
    !if $inputs=1
	!if $wims_user=supervisor
            $inputtext1&nbsp;<textarea id="myinput0" class="schaersvoorde_textarea" cols="$cols" rows="$rows">$(answer$n)</textarea>&nbsp;$ex1
    	!else
    	    $inputtext1&nbsp;<textarea id="myinput0" class="schaersvoorde_textarea" cols="$cols" rows="$rows">$(reply$n)</textarea>&nbsp;$ex1
    	!endif
    !else
	!if $inputs>1
	    <ul class="vlist">
	    !set a_items=!itemcnt $(answer$n)
	    !if $a_items != $[floor($inputs)]
	        !set use_lines=1
	    !else
		!set use_lines=0
	    !endif
	    !for p=1 to $inputs
		<li>
		!if $wims_user=supervisor
		    !if $use_lines=1
			!set deelantwoord=!line $p of $(answer$n)
		    !else
			!set deelantwoord=!item $p of $(answer$n)
		    !endif
        	!else
		    !set deelantwoord=!item $p of $(reply$n)
		!endif
		    $(inputtext$p)&nbsp;$m_rightarrow&nbsp;&nbsp;<input type="text" id="myinput$[$p-1]" class="schaersvoorde_input" size="$cols" value="$deelantwoord" />&nbsp;$(ex$p)
		</li>
	    !next p
	    </ul>
	!endif
    !endif
    </td>
 !endif
!endif
    </tr>
</table>

<div id="send_buttons" class="embedded_central">
!if $inputs != 0
    <input type="button" class="schaersvoorde_ok_button" onclick="javascript:sendanswer();" value="$send" />
!endif
    <input type="button" class="schaersvoorde_nok_button" onclick="javascript:dontknow();"  value="$dontknow" />
</div>
!exit
