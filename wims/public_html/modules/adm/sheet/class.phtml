
!read adm/css.phtml
!read adm/language names.phtml
!!read lang/names.phtml.$modu_lang

!header1

!if $sheet_docpage!=$empty
 !changeto docpage.phtml
!endif
!read adm/class/classname.phtml $wims_classname\
$wims_institutionname

!read adm/title.phtml 1\
$classname\
$sheet_title\
$name_title

<div class="wims_sheet_desc">$sheet_desc</div>
!!expiration date in a variable
!set expir_user=!record 0 of wimshome/log/classes/$wims_class/.$sh
!if $expir_user!=
 !set expir_user=!replace internal \ by in $expir_user
 !set expir_user=!getdef user__$expir_user in wimshome/log/classes/$wims_class/.users/$wims_user
 !set expir_user=!words2items $expir_user
 !for l_ in $expir_user
   !set l_=!replace internal < by ?, in $l_
   !if ? isitemof $l_
     !set sheet_expiration_user=$(l_[2])
   !endif
 !next
!endif
!default sheet_expiration_user=$sheet_expiration
!if $sheet_expiration_user!=$empty and $sheet_active=1
 !set expday=!char 7,8 of $sheet_expiration_user
 !set expmon=!char 5,6 of $sheet_expiration_user
 !set expyear=!char 1 to 4 of $sheet_expiration_user
 !set exphour=!char 10 to -1 of $sheet_expiration_user
 !if $exphour!=
   !set exphour=$ ($exphour)
 !endif
 !read adm/date.phtml
 !set expmon=!item $expmon of $months
 <p id="name_student1">$name_student1$exphour.</p>
!endif

!if $sheet_active=2
 <span class="wims_warning">$wims_name_warning</span>.
 <p id="name_student2">$name_student2</p>
!endif
!if $n=0
 !if $sheet_active=$empty
  $name_sheetempty
 !else
  $name_student4
 !endif
!else
 !set scorestat=!getscorestatus sheet=$sh
 !if $scorestat=yes
  !if $authscoresuspend!=no
   !if $wims_scorereg!=suspend
    $name_scoreopen
    !href cmd=resume&job=suspend $wims_name_scoreclose2
.
    !set wims_menu_items=!append line scoreclose2,1,cmd=resume&job=suspend to $wims_menu_items
   !else
    !set scorestat=no
    $wims_name_scoresuspend
    !href cmd=resume&job=reopen $wims_name_scorereopen
.
    !set wims_menu_items=!append line scorereopen,1,cmd=resume&job=reopen to $wims_menu_items
   !endif
  !else
   $name_scoreclosesup
  !endif
 !else
  $name_scoreclose
 !endif
 
 <div class="wims_sheet">
 <ul class="wims_sheet_list">
 !for i=1 to $n
  !set ex=!record $i of wimshome/log/classes/$wims_class/sheets/.sheet$sh
  !distribute lines $ex into di,pa,require,we,ti,de
  !set got=!word $i of $scores
  !set mean=!word $i of $means
  !set dep=!row $i of $deps
  !set dep=!trim $dep
  <li class="wims_sheet_list">$i.
  !if $dep=$empty or $scorestat!=yes
   !href module=$di&cmd=new&worksheet=$sh&$pa $ti
, $de
   !if $require>0
    <small>$name_score
    $[$mean]/10.</small>
   !endif
  !else
   <font color="red"><b>$ti</b></font>, $de
   !if $require>0
    <small>($name_score2)</small>
   !endif
  !endif
  !if $dep!=$empty
   <small>
   !if , isin $dep
    $name_deps $dep
   !else
    $name_dep $dep
   !endif
   $name_dep2
   </small>
  !endif
 </li>
 !next i
 </ul>
 </div>
!endif

!if $wims_user=supervisor
 !set wims_menu_items=!append line sheetmanagement,1,module=adm/class/sheet&sheet=$sh\
to $wims_menu_items
!endif
!if $n>0
!set wims_menu_items=!append line printable,1,cmd=reply&job=print\
to $wims_menu_items
 !if $exolog!=$empty
  !set wims_menu_items=!append line exolog,1, module=adm/class/exolog&job=llist&logsheet=$sh \
to $wims_menu_items
 !endif
!endif
!set wims_menu_items=!append line myscore,1,module=adm/class/userlist#sheet$sh\
to $wims_menu_items
!tail

