!read adm/language lang/names.phtml

!if robot isin $session or _ isin $session
 !exit
!endif

!if $error isitemof bad_password,bad_loginmail
  !read js/chrono.phtml 5
!endif
!set wims_html_header=$wims_html_header $header_js

!read adm/css.phtml

!if $(module_title_$modu_lang)!=
  !set module_title=$(module_title_$modu_lang)
!endif
!read adm/class/classname.phtml $class_description\
$class_institution

!header

!read adm/title.phtml 3\
\
--- $(wims_name_n_$type) ---

!if $error!=$empty
 <div class="wims_alertmsg">
 !read lang/msg.phtml.$moduclass_lang 
 </div>
!! why not having a !goto end here??
!! (the "!exit" in lang/msg.phtml.$moduclass_lang seems not to be stopping 
!! the rest of the page from being shown)
!! !goto end
 <hr/>
!endif


!!! En fait cela devrait être $idp_method=$empty Comment arrive-t-on ici ?
!if OK iswordof $auth_test and $auth_method isitemof $auth_method_list and $exist_check notsametext yes
!! we get here e.g. in case class_authidp=cas;php
$name_new_participant_external

 !if $type_class > 0 and $type!=authsupervisor and $authtype_!=teacher
  !set tmp_=&subclass=yes
 !endif

 <div class="wimscenter">
!! this is probably the only place we need idp_method=php
!! (e.g. if class_authidp=cas;php)
 !if $(class_authidp[2;]) iswordof php and $class_php_auth!=$empty
 !if $type=authsupervisor
  !set ttmp_=&authtype=teacher
 !endif
   <a href="$class_php_auth?enter=$class$ttmp_" class="wims_button">$name_register</a>        
 !else
   !set wims_ref_class=wims_button
   !href module=adm/class/reguser&class=$class$tmp_&authtype_=$authtype_ $name_register
 !endif
 </div>
 !goto end
!endif

!read $type.phtml
!if $wims_user=$empty or $wims_user=supervisor or $wims_class=$superclass
 !for t in participant,supervisor,example
  !if $t!=$type or $superclass!=$empty
   !set wims_menu_items=!append line n_$t,1,module=$module&type=$t&keyword=$keyword\
to $wims_menu_items
  !! !href module=$module&type=$t&keyword=$keyword $(wims_name_n_$t)
  !endif
 !next t
!endif
!if $wims_user=$empty and $type iswordof supervisor example
 !set wims_menu_items=!append line ,0,\
 classcreate,1,module=adm/class/regclass\
to $wims_menu_items
!endif

 !if $wims_theme_version=0 or $wims_theme_version=
 <div class="wimscenter">
  !href target=wims_help module=help/main&chapter=3 $wims_name_Explanations
 </div>
 !endif
!endif
:end
!tail

!reset auth_user,auth_password,superclass,keyword

