!set wims_module_log=error: $error

!if not_supervisor=$error
 Lo sentimos, pero la operación de preparación / modificación de una hoja
 de trabajo está reservada a los profesores registrados de la clase.
 !exit
!endif

!if bad_class=$error
 ¡Es extraño, pero su clase me aparece como no válida!
 !exit
!endif

!if bad_source=$error
 El elemento número $bad_source del fichero fuente que acaba de enviar no es válido.
 !href cmd=reply&job=prep_putsource&source=$source Corrija los fuentes
 .
 !exit
!endif

!if bad_sheet=$error
 Su número de hoja de trabajo no es válida. ¿Error del software?
 !exit
!endif

!if no_title=$error
 Ha intentado grabar una hoja de trabajo sin título, lo cual no está
 permitido. ¿Error de manipulación?
 !exit
!endif

!if $error=not_secure
 Esta operación sólo puede ser realizada desde una estación de trabajo segura.
 !if $sec=$empty
  No ha definido estaciones de trabajo seguras. Acceso prohibido. Puede
  solicitar al administrador del sitio que lo haga por usted.
 !else
  Acceso prohibido.
 !endif
 !exit
!endif

!if $error=sharing_sheet
 <font color=red><b>¡¡¡Peligro!!!</b></font>
 ¡Sus hojas están siendo compartidas por otras clases!
 !if $wims_ismanager<2
  Deberá pedir al administrador del sitio que desactive la hoja
  por usted.
  !exit
 !endif
 Se arriesga a poner las clases vecinas en un desorden total si desactiva
 esta hoja. Por consiguiente esta operación está <b>fuertemente desaconsejada</b>.
 <p>
 ¿De verdad quiere desactivar la hoja?
 <p><center>
 !href cmd=reply&job=deactivate&confirm=yes Sí, continuar
.&nbsp;&nbsp;
 !href cmd=resume No, cancelar
. </center>
 <p>
 <b>¡Antes de continuar, pida al menos a los profesores de las clases vecinas que
 hagan copias de seguridad de sus clases!</b> Cuando los problemas aparezcan, aunque sea
 después de varios meses, estará obligado a volver al estado ANTERIOR a la
 desactivación, y perderá todo lo ocurrido DESPUÉS, ¡y esto para todas las clases
 que comparten la hoja! Esperamos haberle avisado suficientemente.
 !exit
!endif

!if $error=sheet_in_exam
 Imposible desactivar esta hoja, porque tiene exámenes 
 basados en su contenido.
 !exit
!endif

!if $error=non_empty_activities
 ¡Quiere desactivar la hoja $sheet cuando los participantes ya han empezado
 a trabajar en ella!
 <p>
 !if share iswordof $confirmed
  Además la hoja la comparten otras clases, que pueden estar trabajando en ella 
  y tener puntuaciones también. Por tanto está prohibido desactivarla.
  !exit
 !endif
 Todas las puntuaciones obtenidas en el trabajo en esta hoja quedarán borradas
 si la desactiva. ¿Está usted seguro de querer hacerlo?
 <p><center>
 !href cmd=reply&job=deactivate&confirm=yes Sí, desactivarla
.&nbsp;&nbsp;
 !href cmd=resume No, cancelar
. </center> <p>
 Lista de cuentas que ya han trabajado en esta hoja:
 <p>
 <tt>$worktest</tt>
 <p>
 <b>Nota</b>. Esta acción no debe realizarse salvo si se trata de una clase de 
 pruebas. ¡No siga adelante si los participantes son sus verdaderos alumnos!
 !exit
!endif

!if prep_activate=$error
 Ha solicitado activar la hoja de trabajo $sheet, es decir, hacerla 
 accesible a los participantes de la clase. <p>
 Por favor tenga en cuenta que, una vez activada una hoja de trabajo, no 
 puede ser modificada sin previamente desactivarla, y la desactivación de 
 la hoja conlleva la pérdida de las puntuaciones que se han conseguido en 
 el trabajo en la misma, si dicha desactivación no está prohibida 
 por la situación.
 <p>
 ¿Desea continuar?
 <p><center>
 !href cmd=reply&job=activate Sí, activarla
.&nbsp;&nbsp;
 !href cmd=resume No, cancelar
.</center>
 !exit
!endif

!if prep_erase=$error
 ¿Realmente quiere borrar la hoja de trabajo #$sheet ($title)?
 <p><center>
 !href cmd=reply&job=erase Sí, borrar
.&nbsp;&nbsp;
 !href cmd=resume No, cancelar
.</center>
 !exit
!endif
 
!if prep_expire=$error
 Esta hoja número $sheet ($title) expira normalmente el $expday
 !item $expmon of $months
 $expyear. ¿Quiere hacerla expirar ahora?
 <p><center>
 !href cmd=reply&job=expire Sí, hacerla expirar
 .&nbsp;&nbsp;
 !href cmd=resume No, cancelar
 . </center>
 <p><b>Nota.</b> Sus estudiantes no pueden continuar trabajando en una hoja
 que ha expirado. Pero las puntuaciones anteriores se conservarán (y se tomarán en 
 cuenta en las estadísticas), y puede seguir consultándolas.
 !exit
!endif

!if prep_putsource=$error
 Si tiene el fichero fuente de una hoja de trabajo guardada anteriormente, puede
 insertarlo directamente en la hoja actual, copiando estos 
 fuentes en la ventana siguiente, y pulsando después el botón <tt>Enviar</tt>.
 También puede utilizar este formulario para insertar los fuentes de una
 hoja pública por el proceso de copiar y pegar.
 <p>
 Por otro lado,
 !href cmd=resume volver a la página principal de la hoja de trabajo.
 !form reply
 <input type=hidden name=job value=putsource><center>
 <textarea cols=55 rows=10 name=source>$source</textarea>
 <p><input type=submit value="Enviar">
 </center></form>
 <b>Atención</b>. ¡No inserte un fichero fuente modificado! Se arriesga a
 inutilizar su hoja de trabajo.
 !exit
!endif

!if prep_modify=$error
 !set cnt=!recordcnt classes/$wims_class/sheets/.sheet$sheet
 !if $modif>$cnt or $modif<1
  Has enviado una solicitud no válida. Ignorada.
 !else
  !set exo=!record $modif of classes/$wims_class/sheets/.sheet$sheet
  !distribute lines $exo into directory,parm,require,weight,title,desc,dep
  !set orgtit=!module title $directory
  <p><center><h3>Modificación del ejercicio $modif</h3></center>
  !form reply
  <input type=hidden name=modif value=$modif>
  <input type=hidden name=job value=modify>
  <ul>
  <li>Título: <small>(El título original es <em>$orgtit</em>)
  </small> <br>
  <input size=50 name=mod_title value="$title">
  <li>Descripción:<br>
  <textarea name=mod_desc rows=5 cols=50>$desc</textarea>
  <li>Número de puntos pedidos: 
  <input size=4 name=mod_require value="$require">,
  de peso
  <input size=4 name=mod_weight value="$weight">.
  <li>Dependencias de las puntuaciones:
  <input size=40 name=mod_dep value="$dep">.
  !reset mod_dep
  </ul>
  <p><center><input type=submit value="Guardar los cambios"></form>
  </center> <p>
  !href cmd=resume Descartar los cambios.
  <p><small>
  <b>Ayuda</b>. <tt>Dependencias de las puntuaciones</tt> quiere decir que 
  un participante debe primero lograr puntos en otros ejercicios de la hoja, 
  antes de poder trabajar en este. Por ejemplo,
  <font color=blue><tt>1:50,2:30,3+4+5:60</tt></font>
  significa que el participante debe tener un éxito del 50% en el ejercicio 1,
  30% en el ejercicio 2, y una media de éxito del 60% en los ejercicios
  3, 4 y 5.

  </small>

 !endif
!endif

!msg $error
