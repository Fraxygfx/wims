
!read adm/title.phtml 1\
$classname\
$name_title_examcheck

!if _check isin $session
 !set error=bad_op
 !goto msg
!endif

!if $error!=$empty
 :msg
 <div class="msg">
  !read lang/msg.phtml.$moduclass_lang
 </div>
!else
 !if $checksessions=$empty
  <p class="no_exampart">
   $name_no_exampart
  </p>
 !else
  <p class="exampart">
   $name_exampart
  </p>
  $table_header
  $table_hdtr<th rowspan="2">$name_Session</th><th rowspan="2">$name_Exam</th><th rowspan="2">$name_Score<span class="small">/$scoremax</span></th>
  <th colspan="$maxexo">$name_Exercise </th>
  <th>$name_Start</th>
  <th>$name_Duration</th></tr>
  $table_hdtr
   !for i=1 to $maxexo
    <th>$i</th>
   !next i
  </tr>
  !for ses in $checksessions
   !for x in $(exam$ses)
    $table_tr<td class="small">$ses</td>
    <td>$x</td>
    <td>$[rint($(score$(ses)$x)*$scoremax)/10]</td>
    !let nbx=!recordcnt wimshome/log/classes/$wims_class/exams/.exam$x
    !for i=1 to $nbx
      <td>
      !if $i isitemof $(exo$(ses)$x)
       !let s=!defof w_module_score in wimshome/log/classes/$wims_class/examlog/$checkuser/$ses/$x.$i
       !!if $s=$empty
        !!perhaps the file is too long
        !!let s=!record 0 of wimshome/log/classes/$wims_class/examlog/$checkuser/$ses/$x.$i
        !!let s=!getopt w_module_score in $s
        !!! if $module_score is empty, $s can be the line after, so we test there is only numbers and .
        !!let s0=!text select 0123456789. in $s
        !!if $s0!=$s
        !! !reset s
        !!!endif
       !!!endif
      !if $s!=$empty
        !set s=$[rint($s*$scoremax)/10]
      !else
        !if $(duree$(ses_)$x)=$empty
         !set s=&dagger;
        !else
         !set s=??
        !endif
      !endif
       !href target=wims_check module=$module&cmd=new&job=examcheck&checkuser=$checkuser&checksession=$ses&checkexo=$x.$i&checkstep=1 $s
      !else
        &nbsp;
      !endif
     </td>
    !next i
    !if $nbx<$maxexo
     !for i=$[$nbx+1] to $maxexo
      <td style="background-image:url(gifs/bg/crossgrey.gif)">&nbsp;</td>
     !next i
    !endif
   <td class="small">
    !read date.phtml $(start$(ses)$x)
   </td>
   <td class="small">
    !if $(duree$(ses)$x)!=$empty
      !item 1 of $(duree$(ses)$x)
$ $
      !char 1 to 3 of $name_minutes
$ $
      !item 2 of  $(duree$(ses)$x)
    !endif
   </td>
  </tr>
    !next x
  !next sess
  $table_end
 !endif
!endif
!if $wims_user!=supervisor
 !set wims_menu_items=!append line myscore,1,cmd=reply&job=getuser&getuser=$checkuser\
to $wims_menu_items
!else
 !set wims_menu_items=!append line scores,1,cmd=reply&job=getuser&getuser=$checkuser\
to $wims_menu_items
 !read adm/class/getnextuser $wims_class,$checkuser,examcheck,checkuser
 !set wims_menu_items=!append line ,0,\
 part_list,1,cmd=resume\
 to $wims_menu_items
!endif
