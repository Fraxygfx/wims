!set joker=--
!if $gcnt<=0
 There is no manually entered grades yet in your class.
 !href cmd=reply&method=column&cc=1 Add one
.
!set wims_menu_items=!append line addmanual,1,cmd=reply&method=column&cc=1\
to $wims_menu_items
 !exit
!endif

$table_header
$table_hdtr<th>Name<th><small>Average</small>
!for g=1 to $gcnt
 <th><small>
 !set t_=!item $g of $titles
 !if $ucnt<=$maxuser
  !href cmd=reply&method=column&cc=$g $t_
 !else
  $t_
 !endif
 </small>
!next g

$table_hdtr<th>Weight<td align=center>--</th>
!for g=1 to $gcnt
 !set w_=!item $g of $weights
 !default w_=1
 <td align=center>$w_
!next g
!for u=1 to $ucnt
 !set n_=!item $u of $ulist
 !set f_=!item $u of $flist
 !set l_=!item $u of $llist
 $table_tr<td align=center>
 !href cmd=reply&method=user&un=$n_ $l_, $f_
 !set t_=!positionof item $n_ in $uulist
 !if $t_!=
  !set v_=!record $t_+1 of wimshome/log/classes/$wims_class/.grades
 !else
  !set v_=!makelist $joker for x=1 to $gcnt
  !set v_=$n_,$f_,$v_
 !endif
 !set a_=0
 !for g=1 to $gcnt
  !set G$g=!item $g+2 of $v_
  !default G$g=0
  !set w_=!item $g of $weights
  !set a_=$[$a_+($w_)*$(G$g)]
 !next g
 !if $joker isin ($v_[3..-1])
  !set a_=NaN
 !endif
 
 !endif
 !if $a_!=NaN
 !set a_=$[rint(100*$a_/$wtot)/100]
 !endif
 <td align=center>$a_
 !for g=1 to $gcnt
  <td align=center>$(G$g)
 !next g
!next u
$table_end

<p>Click on the name of a column or a participant to
!if $gcnt<$maxcol
 modify grades, or 
 !href cmd=reply&method=column&cc=$[$gcnt+1] add another column
.
 !set wims_menu_items=!append line addmanual,1,cmd=reply&method=column&cc=$[$gcnt+1]\
to $wims_menu_items
!else
 modify grades.
!endif
!if $gcnt>0
<p>
You can also directly
!href cmd=reply&method=raw modify the source
 of the grades, or
 !href module=adm/class/userlist&cmd=new&job=csv communicate the grades
 with your spreadsheet.
 !set wims_menu_items=!append line raw,1,cmd=reply&method=raw\
 csv,1,module=adm/class/userlist&cmd=new&job=csv\
to $wims_menu_items
!endif

