!goto $job

:checkuser
:checkident
:checkclass
:checksheet
:modclass
:delclass
:delsheet
:deluser
:adduser
:recuser

!exit

:listexams
:listsheets
 !shortout queryclass=$qclass\
count=$cnt\
titlelist=$titles\

!exit


:listlinks
!shortout nblinks=$nblink\
listlinks=$listlinks\

!exit

:getsheet
 !shortout queryclass=$qclass\
querysheet=$qsheet\
sheet_properties=$sheet_properties\
exocnt=$exocnt\
exotitlelist=$exotitlelist\

!exit

:addsheet
 !shortout queryclass=$qclass\
sheet_id=$qsheet
!exit

:addclass
 !shortout $cd
!exit

:getclass
!shortout <class>\
  <qclass> $qclass</qclass>\
  <rclass> $rclass</rclass>\

!for d in $option
 !shortout   \
    <$d>$(class_$d)</$d>\

!next d
!shortout </class>
!exit

:getclassmodif
!shortout $modif
!exit

:getuser
!shortout queryclass=$qclass\
queryuser=$quser\

!for d in $option
 !shortout $d=$(user_$d)\

!next d
!exit

:getscore
!for v in examscore, weights, requires, persheet, gotdetail, meandetail
 $v=!trim $($v)
 $v=!replace internal $\
$ by \\
$ in $($v)
!next v

!shortout queryclass=$qclass\
queryuser=$quser\
scoremax=$scoremax\
\
examscores=$examscore\
\
weights=$weights\
\
requirepoints=$requires\
\
sheetsummaries=$persheet\
\
gotpoints=$gotdetail\
\
scoreaverages=$meandetail\

!exit

:getlog

!if $option=score or $option=noscore
 !sh cd $wims_home/log/classes/$qclass\
	cat $option/$quser 2>/dev/null
!else
 !sh cd $wims_home/log/classes/$qclass\
	cat score/$quser noscore/$quser 2>/dev/null | sort
!endif
!exit

:gettime
 !shortout $now_year$now_month$now_day.$now_hour:$now_min:$now_sec
!exit

:authuser
 !shortout $wims_session
# !shortout $wims_ref_name?session=$wims_session.1&module=home

:getcourse
 !shortout queryclass=$qprogram\
 courses=$wims_class

:listclasses
# listclasse represente les couples qclass,rclass pour chaque classe
# accessible d'un serveur donne
list_cnt=!linecnt $listclasses
index=1

!shortout <list>\

!while $index <= $list_cnt
	!read jobs/getclass.proc
	
	!shortout <class>\
	<qclass>$(listclasses[$index;1])</qclass>\
	<connection>\
        	<rclass>$(listclasses[$index;2])</rclass>\
          	<ident>$ident</ident>\
	</connection>\
 
	!for d in $option
		!shortout \
	<$d>$(class_$d)</$d>\

	!next d
	
	!shortout \
</class>\

	!increase index
!endwhile
  
!shortout \
</list>

!exit

:getclassesuser
!shortout $listclassesuser\

!exit
