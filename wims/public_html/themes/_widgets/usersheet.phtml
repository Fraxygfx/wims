!! to put elsewhere when finished the bar
!!
!! it translation to be inserted when applicable
!! non svolto,non completato,svolto,svolto brillantemente
!distribute items non travaillé,non réussi,réussi,brillament réussi into wims_name_exo_untry,wims_name_exo_undone,wims_name_exo_done,wims_name_exo_congratulation
!set bar_scoreexo_limit=9

!read themes/_widgets/user_varsheet.phtml

!if $n>0
 <!-- _widgets/usersheet.phtml -->


<div class="wims_seq">
  <div class="wims_title_seq">$wims_name_sheet</div>

 !set sevlist=!record 0 of wimshome/log/classes/$wims_class/sheets/.severity
 <ul class="wims_work_list">
  !for i=1 to $n
    !set se=!item $i of $aclist
    !distribute lines $(s_$se) into ac,t_,ti,de
    <li class="wims_sheet_item">
      <span class="wims_user_sheet_type">$wims_name_Sheet $se.</span>
      <span class="wims_user_sheet_title">
        !href module=adm/sheet&sh=$se $ti
      </span>
      <ul class="wims_sheet_info">
        !if showshweight iswordof $class_option
          <li class="wims_sheet_weight small">$wims_name_coeff $(w_$se)</li>
        !endif
        !if $ac>=2
          <li class="wims_user_sheet_expire small">$U_expired</li>
        !else
          !if showshexpire iswordof $class_option
            <li class="wims_user_sheet_expire small">
              !read misc/expire.phtml.$lang $t_
            </li>
          !endif
        !endif
      </ul>
    !set pe=!line $se of $percents
    !set try=!getscoretry sheet=$se
    !set try0=!text select 123456789 in $try
    !distribute words $pe into p1,p2,p3,p4
    !if $try0!=$empty
       <div class="wims_user_info">
        !distribute item $[$p1/100],$[$p2/10],$[$p3/100],$[$p4/100] into x0_,y_,x1_,x2_
        !set ff_$se=!mathsubst Q=$y_ in $(f_$se)
        !for sev=0 to 2
          !set ff_$se=!mathsubst I$sev=$(x$(sev)_) in $(ff_$se)
        !next
        !read adm/class/colors $[ceil(10*$(ff_$se))],color
        !default scoremax=10
        <span style=$style_note>
        $(wims_name_thsheet[9]): $[ceil(10*$scoremax*$(ff_$se))/10]/$scoremax
        </span>
!!      $(wims_name_thsheet[7]): $[$p2]/10,
!!      I0 $(wims_name_thsheet[5]): $p1%,
!!      I1 $(wims_name_thsheet[10]): $p3%,
!!      I2 $(wims_name_thsheet[13]): $[$p4/10]/10
      </div>
     !endif
!!## bar
    !set require=!getscorerequire sheet=$se
    !if I0 isin $(f_$se)
      !set d_=!getscore sheet=$se
    !endif
    !if I1 isin $(f_$se)
      !set d_=!getscorebest sheet=$se
    !endif
    !if I2 isin $(f_$se)
      !set d_=!getscorelevel sheet=$se
    !endif
    !set d_qual=!getscoremean sheet=$se
    !set nb_exo=!wordcnt $d_
    !set d_=!words2items $d_
    !set d_qual=!words2items $d_qual
    !set require=!words2items $require
    <div class="wims_score_bar float_right">
    <ol>
     !for ii=1 to $nb_exo
       !set exo_try= !word $ii of $try
       !ifval 10*$(d_[$ii])/$(require[$ii]) > $bar_scoreexo_limit
         !if $(d_qual[$ii]) > $exo_bar_limit
           !set exo_class=wims_exo_done wims_congratulation, $wims_name_exo_congratulation
         !else
           !set exo_class=wims_exo_done,$wims_name_exo_done
         !endif
      !else
         !if $exo_try >=1
           !set exo_class=wims_exo_undone,$wims_name_exo_undone
         !else
           !set exo_class=wims_exo_untry,$wims_name_exo_untry
         !endif
       !endif
       <li class="$(exo_class[1])" title="$wims_name_Exercise $ii: $(exo_class[2])">
             $wims_name_Exercise $ii: $(exo_class[2])
       </li>
     !next
   </ol>
   </div>
!!## bar end
   </li>
  !next i
 </ul>
</div>
 <!-- end _widgets/usersheet.phtml -->
!endif
